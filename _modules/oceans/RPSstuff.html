<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>oceans.RPSstuff &#8212; oceans 1.1.4 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=c058f7c8" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=f6a572b4" />
    <script src="../../_static/documentation_options.js?v=00f267c6"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../index.html">
    <img class="logo" src="../../_static/logo.png" alt="Logo" />
    
    <h1 class="logo logo-name">oceans</h1>
    
  </a>
</p>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=pyoceans&repo=oceans&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





    

<p>
<a class="badge" href="https://travis-ci.org/pyoceans/oceans">
    <img
        alt="https://secure.travis-ci.org/pyoceans/oceans.svg?branch=master"
        src="https://secure.travis-ci.org/pyoceans/oceans.svg?branch=master"
    />
</a>
</p>


<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../datasets.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">oceans.datasets</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../colormaps.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">oceans.colormaps</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plotting.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">oceans.plotting</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ocfis.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">oceans.ocfis</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filters.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">oceans.filters</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../RPSstuff.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">oceans.RPSstuff</span></code></a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for oceans.RPSstuff</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.ma</span> <span class="k">as</span> <span class="nn">ma</span>

<span class="n">earth_radius</span> <span class="o">=</span> <span class="mf">6371.0e3</span>


<div class="viewcode-block" id="h2hms">
<a class="viewcode-back" href="../../RPSstuff.html#oceans.RPSstuff.h2hms">[docs]</a>
<span class="k">def</span> <span class="nf">h2hms</span><span class="p">(</span><span class="n">hours</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts hours to hours, minutes, and seconds.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; h2hms(12.51)</span>
<span class="sd">    (np.float64(12.0), np.float64(30.0), np.float64(36.0))</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hour</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">hours</span><span class="p">)</span>
    <span class="n">mins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">hours</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">60.0</span>
    <span class="n">mn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">mins</span><span class="p">)</span>
    <span class="n">secs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">mins</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">60.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">hour</span><span class="p">,</span> <span class="n">mn</span><span class="p">,</span> <span class="n">secs</span></div>



<div class="viewcode-block" id="hms2h">
<a class="viewcode-back" href="../../RPSstuff.html#oceans.RPSstuff.hms2h">[docs]</a>
<span class="k">def</span> <span class="nf">hms2h</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts hours, minutes, and seconds to hours.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; hms2h(12.0, 30.0, 36.0)</span>
<span class="sd">    12.51</span>
<span class="sd">    &gt;&gt;&gt; # Or,</span>
<span class="sd">    &gt;&gt;&gt; hms2h(123036)</span>
<span class="sd">    np.float64(12.51)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span>
        <span class="n">hms</span> <span class="o">=</span> <span class="n">h</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">hms</span> <span class="o">/</span> <span class="mi">10000</span><span class="p">)</span>
        <span class="n">ms</span> <span class="o">=</span> <span class="n">hms</span> <span class="o">-</span> <span class="n">h</span> <span class="o">*</span> <span class="mi">10000</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ms</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">ms</span> <span class="o">-</span> <span class="n">m</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="n">hours</span> <span class="o">=</span> <span class="n">h</span> <span class="o">+</span> <span class="n">m</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">s</span> <span class="o">/</span> <span class="mi">3600</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hours</span> <span class="o">=</span> <span class="n">h</span> <span class="o">+</span> <span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">s</span> <span class="o">/</span> <span class="mi">60</span><span class="p">)</span> <span class="o">/</span> <span class="mi">60</span>
    <span class="k">return</span> <span class="n">hours</span></div>



<div class="viewcode-block" id="ms2hms">
<a class="viewcode-back" href="../../RPSstuff.html#oceans.RPSstuff.ms2hms">[docs]</a>
<span class="k">def</span> <span class="nf">ms2hms</span><span class="p">(</span><span class="n">millisecs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts milliseconds to integer hour, minute, seconds.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; ms2hms(1e3 * 60)</span>
<span class="sd">    (np.float64(0.0), np.float64(1.0), np.float64(0.0))</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">millisecs</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">hour</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">sec</span> <span class="o">/</span> <span class="mi">3600</span><span class="p">)</span>
    <span class="n">mn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="mi">3600</span><span class="p">)</span> <span class="o">/</span> <span class="mi">60</span><span class="p">)</span>
    <span class="n">sec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="mi">60</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">hour</span><span class="p">,</span> <span class="n">mn</span><span class="p">,</span> <span class="n">sec</span></div>



<div class="viewcode-block" id="julian">
<a class="viewcode-back" href="../../RPSstuff.html#oceans.RPSstuff.julian">[docs]</a>
<span class="k">def</span> <span class="nf">julian</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mi</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">noon</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts Gregorian calendar dates to Julian dates</span>

<span class="sd">    USAGE: [j]=julian(y,m,d,h)</span>

<span class="sd">    DESCRIPTION:  Converts Gregorian dates to decimal Julian days using the</span>
<span class="sd">                  astronomical conversion, but with time zero starting at</span>
<span class="sd">                  midnight instead of noon.  In this convention, Julian day</span>
<span class="sd">                  2440000 begins at 0000 hours, May 23, 1968. The decimal</span>
<span class="sd">                  Julian day, with double precision, yields an accuracy of</span>
<span class="sd">                  decimal days of about 0.1 milliseconds.</span>

<span class="sd">    If you want Julian days to start and end at noon set `noon` to True.</span>

<span class="sd">    INPUT:</span>
<span class="sd">    y : year (e.g., 1979) component</span>
<span class="sd">    m : month (1-12) component</span>
<span class="sd">    d : day (1-31) component of Gregorian date</span>
<span class="sd">    hour : hours (0-23)</span>
<span class="sd">    min : minutes (0-59)</span>
<span class="sd">    sec : decimal seconds or</span>
<span class="sd">    h : decimal hours (assumed 0 if absent)</span>

<span class="sd">    OUTPUT:</span>
<span class="sd">    j : decimal Julian day number</span>

<span class="sd">    last revised 1/3/96 by Rich Signell (rsignell@usgs.gov)</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; julian(1968, 5, 23, 0)</span>
<span class="sd">    array([2440000.])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">mi</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">,</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">mi</span><span class="p">,</span> <span class="n">s</span><span class="p">)))</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">hms2h</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">mi</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="n">mo</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">9</span>
    <span class="n">yr</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">m</span> <span class="o">&gt;</span> <span class="mi">2</span>
    <span class="n">mo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">3</span>
    <span class="n">yr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">yr</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">)</span>
    <span class="n">yr</span> <span class="o">=</span> <span class="n">yr</span> <span class="o">-</span> <span class="n">c</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">j</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="mi">146097</span> <span class="o">*</span> <span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="mi">1461</span> <span class="o">*</span> <span class="n">yr</span><span class="p">)</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="mi">153</span> <span class="o">*</span> <span class="n">mo</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mf">5.0</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">d</span>
        <span class="o">+</span> <span class="mi">1721119</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">noon</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="p">(</span><span class="n">h</span> <span class="o">-</span> <span class="mi">12</span><span class="p">)</span> <span class="o">/</span> <span class="mi">24</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">24</span>

    <span class="k">return</span> <span class="n">j</span></div>



<div class="viewcode-block" id="jdrps2jdmat">
<a class="viewcode-back" href="../../RPSstuff.html#oceans.RPSstuff.jdrps2jdmat">[docs]</a>
<span class="k">def</span> <span class="nf">jdrps2jdmat</span><span class="p">(</span><span class="n">jd</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert Signell&#39;s Julian days to Matlab&#39;s Serial day</span>
<span class="sd">    matlab&#39;s serial date = 1 at 0000 UTC, 1-Jan-0000.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; jdrps2jdmat(2440000)</span>
<span class="sd">    array([718941.])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jd</span> <span class="o">-</span> <span class="n">julian</span><span class="p">(</span><span class="mi">0000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span></div>



<div class="viewcode-block" id="jdmat2jdrps">
<a class="viewcode-back" href="../../RPSstuff.html#oceans.RPSstuff.jdmat2jdrps">[docs]</a>
<span class="k">def</span> <span class="nf">jdmat2jdrps</span><span class="p">(</span><span class="n">jdmat</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert Matlab&#39;s Serial Day to Signell&#39;s Julian days</span>
<span class="sd">    matlab&#39;s serial date = 1 at 0000 UTC, 1-Jan-0000.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; jdmat2jdrps(718941)</span>
<span class="sd">    array([2440000.])</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jdmat</span> <span class="o">+</span> <span class="n">julian</span><span class="p">(</span><span class="mi">0000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span></div>



<div class="viewcode-block" id="gregorian">
<a class="viewcode-back" href="../../RPSstuff.html#oceans.RPSstuff.gregorian">[docs]</a>
<span class="k">def</span> <span class="nf">gregorian</span><span class="p">(</span><span class="n">jd</span><span class="p">,</span> <span class="n">noon</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts decimal Julian days to Gregorian dates using the astronomical</span>
<span class="sd">    conversion, but with time zero starting at midnight instead of noon.  In</span>
<span class="sd">    this convention, Julian day 2440000 begins at 0000 hours, May 23, 1968.</span>
<span class="sd">    The Julian day does not have to be an integer, and with Matlab&#39;s double</span>
<span class="sd">    precision, the accuracy of decimal days is about 0.1 milliseconds.</span>

<span class="sd">    INPUT:   jd  = decimal Julian days</span>

<span class="sd">    OUTPUT:  gtime = six column Gregorian time matrix, where each row is:</span>
<span class="sd">    [yyyy mo da hr mi sec].</span>
<span class="sd">    yyyy = year (e.g., 1979)</span>
<span class="sd">    mo = month (1-12)</span>
<span class="sd">    da = day (1-31)</span>
<span class="sd">    hr = hour (0-23)</span>
<span class="sd">    mi = minute (0-59)</span>
<span class="sd">    sec = decimal seconds</span>
<span class="sd">    example: [1990 12 12 0 0 0] is midnight on Dec 12, 1990.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; gregorian(2440000)</span>
<span class="sd">    array([[1968.,    5.,   23.,    0.,    0.,    0.]])</span>

<span class="sd">    AUTHOR: Rich Signell  (rsignell@usgs.gov)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Add 0.2 milliseconds before Gregorian calculation to prevent</span>
    <span class="c1"># roundoff error resulting from math operations on time</span>
    <span class="c1"># from occasionally representing midnight as</span>
    <span class="c1"># (for example) [1990 11 30 23 59 59.99...] instead of [1990 12 1 0 0 0]);</span>
    <span class="c1"># If adding a 0.2 ms to time (each time you go back and forth between</span>
    <span class="c1"># Julian and Gregorian) bothers you more than the inconvenient</span>
    <span class="c1"># representation of Gregorian time at midnight you can comment this</span>
    <span class="c1"># line out...</span>

    <span class="n">jd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">jd</span><span class="p">)</span>
    <span class="n">jd</span> <span class="o">=</span> <span class="n">jd</span> <span class="o">+</span> <span class="mf">2.0e-9</span>

    <span class="k">if</span> <span class="n">noon</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">jd</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">+</span> <span class="mi">12</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">h</span> <span class="o">&gt;=</span> <span class="mi">24</span>
        <span class="n">jd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">jd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">24</span>

    <span class="n">secs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">jd</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">3600</span>

    <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">jd</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1721119</span>

    <span class="n">ini</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ini</span> <span class="o">/</span> <span class="mi">146097</span><span class="p">)</span>
    <span class="n">j</span> <span class="o">=</span> <span class="n">ini</span> <span class="o">-</span> <span class="mi">146097</span> <span class="o">*</span> <span class="n">y</span>
    <span class="n">ini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">j</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">ini</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">ini</span> <span class="o">+</span> <span class="mi">3</span>
    <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ini</span> <span class="o">/</span> <span class="mi">1461</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(((</span><span class="n">ini</span> <span class="o">-</span> <span class="mi">1461</span> <span class="o">*</span> <span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">ini</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">d</span> <span class="o">-</span> <span class="mi">3</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ini</span> <span class="o">/</span> <span class="mi">153</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(((</span><span class="n">ini</span> <span class="o">-</span> <span class="mi">153</span> <span class="o">*</span> <span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">j</span>
    <span class="n">mo</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="mi">9</span>
    <span class="n">yr</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">m</span> <span class="o">&lt;</span> <span class="mi">10</span>
    <span class="n">mo</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">3</span>
    <span class="n">yr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="n">hr</span><span class="p">,</span> <span class="n">mi</span><span class="p">,</span> <span class="n">sc</span> <span class="o">=</span> <span class="n">s2hms</span><span class="p">(</span><span class="n">secs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">yr</span><span class="p">,</span> <span class="n">mo</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">hr</span><span class="p">,</span> <span class="n">mi</span><span class="p">,</span> <span class="n">sc</span><span class="p">]</span></div>



<div class="viewcode-block" id="s2hms">
<a class="viewcode-back" href="../../RPSstuff.html#oceans.RPSstuff.s2hms">[docs]</a>
<span class="k">def</span> <span class="nf">s2hms</span><span class="p">(</span><span class="n">secs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts seconds to integer hour,minute,seconds</span>
<span class="sd">    Usage: hour, min, sec = s2hms(secs)</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; s2hms(3600 + 60 + 1)</span>
<span class="sd">    (np.float64(1.0), np.float64(1.0), np.int64(1))</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">secs</span> <span class="o">/</span> <span class="mi">3600</span><span class="p">)</span>
    <span class="n">mi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">secs</span><span class="p">,</span> <span class="mi">3600</span><span class="p">)</span> <span class="o">/</span> <span class="mi">60</span><span class="p">)</span>
    <span class="n">sc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">secs</span><span class="p">,</span> <span class="mi">60</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">hr</span><span class="p">,</span> <span class="n">mi</span><span class="p">,</span> <span class="n">sc</span></div>



<span class="c1"># FIXME: STOPPED HERE</span>
<div class="viewcode-block" id="ss2">
<a class="viewcode-back" href="../../RPSstuff.html#oceans.RPSstuff.ss2">[docs]</a>
<span class="k">def</span> <span class="nf">ss2</span><span class="p">(</span><span class="n">jd</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return Gregorian start and stop dates of Julian day variable</span>
<span class="sd">    Usage:  start, stop = ss2(jd)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">gregorian</span><span class="p">(</span><span class="n">jd</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">stop</span> <span class="o">=</span> <span class="n">gregorian</span><span class="p">(</span><span class="n">jd</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span></div>



<div class="viewcode-block" id="angled">
<a class="viewcode-back" href="../../RPSstuff.html#oceans.RPSstuff.angled">[docs]</a>
<span class="k">def</span> <span class="nf">angled</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ANGLED: Returns the phase angles in degrees of a matrix with complex</span>
<span class="sd">            elements.</span>

<span class="sd">    Usage:</span>
<span class="sd">        deg = angled(h)</span>
<span class="sd">        h = complex matrix</span>
<span class="sd">        deg = angle in math convention (degrees counterclockwise from &quot;east&quot;)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">deg</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span></div>



<div class="viewcode-block" id="ij2ind">
<a class="viewcode-back" href="../../RPSstuff.html#oceans.RPSstuff.ij2ind">[docs]</a>
<span class="k">def</span> <span class="nf">ij2ind</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">return</span> <span class="n">m</span> <span class="o">*</span> <span class="n">i</span> <span class="o">-</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># TODO: Check this +1</span></div>



<div class="viewcode-block" id="ind2ij">
<a class="viewcode-back" href="../../RPSstuff.html#oceans.RPSstuff.ind2ij">[docs]</a>
<span class="k">def</span> <span class="nf">ind2ij</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">ind</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ind2ij returns i, j indices of array.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">ind</span> <span class="o">/</span> <span class="n">m</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="n">i</span><span class="p">[</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>
    <span class="k">return</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span></div>



<div class="viewcode-block" id="rms">
<a class="viewcode-back" href="../../RPSstuff.html#oceans.RPSstuff.rms">[docs]</a>
<span class="k">def</span> <span class="nf">rms</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute root mean square for each column of matrix u.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: use an axis arg.</span>
    <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">size</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">m</span><span class="p">)</span></div>



<div class="viewcode-block" id="z0toCn">
<a class="viewcode-back" href="../../RPSstuff.html#oceans.RPSstuff.z0toCn">[docs]</a>
<span class="k">def</span> <span class="nf">z0toCn</span><span class="p">(</span><span class="n">z0</span><span class="p">,</span> <span class="n">H</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert roughness height z0 to Chezy &quot;C&quot; and Manning&#39;s &quot;n&quot; which is a</span>
<span class="sd">    function of the water depth</span>

<span class="sd">    Inputs:</span>
<span class="sd">        z0 = roughness height (meters)</span>
<span class="sd">        H = water depth (meters) (can be vector)</span>
<span class="sd">    Outputs:</span>
<span class="sd">        C = Chezy &quot;C&quot; (non-dimensional)</span>
<span class="sd">        n = Manning&#39;s &quot;n&quot; (non-dimensional)</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; # finds vectors C and n corresponding to a z0=0.003</span>
<span class="sd">    &gt;&gt;&gt; # and a range of water depths from 2--200 meters.</span>
<span class="sd">    &gt;&gt;&gt; C, n = z0toCn(0.003, np.arange(2, 200))</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">k_s</span> <span class="o">=</span> <span class="mi">30</span> <span class="o">*</span> <span class="n">z0</span>
    <span class="n">C</span> <span class="o">=</span> <span class="mi">18</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="n">H</span> <span class="o">/</span> <span class="n">k_s</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="n">H</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">6.0</span><span class="p">))</span> <span class="o">/</span> <span class="n">C</span>

    <span class="k">return</span> <span class="n">C</span><span class="p">,</span> <span class="n">n</span></div>



<div class="viewcode-block" id="z0tocd">
<a class="viewcode-back" href="../../RPSstuff.html#oceans.RPSstuff.z0tocd">[docs]</a>
<span class="k">def</span> <span class="nf">z0tocd</span><span class="p">(</span><span class="n">z0</span><span class="p">,</span> <span class="n">zr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates CD at a given ZR corresponding to Z0.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cd</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">z0</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">zr</span> <span class="o">/</span> <span class="n">z0</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">cd</span></div>



<div class="viewcode-block" id="short_calc">
<a class="viewcode-back" href="../../RPSstuff.html#oceans.RPSstuff.short_calc">[docs]</a>
<span class="k">def</span> <span class="nf">short_calc</span><span class="p">(</span><span class="n">amin</span><span class="p">,</span> <span class="n">amax</span><span class="p">):</span>
    <span class="n">rang</span> <span class="o">=</span> <span class="mi">32767</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="mi">32767</span><span class="p">)</span>
    <span class="n">add_offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">amax</span> <span class="o">+</span> <span class="n">amin</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
    <span class="n">scale_factor</span> <span class="o">=</span> <span class="p">(</span><span class="n">amax</span> <span class="o">-</span> <span class="n">amin</span><span class="p">)</span> <span class="o">/</span> <span class="n">rang</span>
    <span class="k">return</span> <span class="n">add_offset</span><span class="p">,</span> <span class="n">scale_factor</span></div>



<div class="viewcode-block" id="gsum">
<a class="viewcode-back" href="../../RPSstuff.html#oceans.RPSstuff.gsum">[docs]</a>
<span class="k">def</span> <span class="nf">gsum</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Just like sum, except that it skips over bad points.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xnew</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>



<div class="viewcode-block" id="gmean">
<a class="viewcode-back" href="../../RPSstuff.html#oceans.RPSstuff.gmean">[docs]</a>
<span class="k">def</span> <span class="nf">gmean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Just like mean, except that it skips over bad points.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xnew</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>



<div class="viewcode-block" id="gmedian">
<a class="viewcode-back" href="../../RPSstuff.html#oceans.RPSstuff.gmedian">[docs]</a>
<span class="k">def</span> <span class="nf">gmedian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Just like median, except that it skips over bad points.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xnew</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>



<div class="viewcode-block" id="gmin">
<a class="viewcode-back" href="../../RPSstuff.html#oceans.RPSstuff.gmin">[docs]</a>
<span class="k">def</span> <span class="nf">gmin</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Just like min, except that it skips over bad points.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xnew</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>



<div class="viewcode-block" id="gmax">
<a class="viewcode-back" href="../../RPSstuff.html#oceans.RPSstuff.gmax">[docs]</a>
<span class="k">def</span> <span class="nf">gmax</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Just like max, except that it skips over bad points.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xnew</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>



<div class="viewcode-block" id="gstd">
<a class="viewcode-back" href="../../RPSstuff.html#oceans.RPSstuff.gstd">[docs]</a>
<span class="k">def</span> <span class="nf">gstd</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Just like std, except that it skips over bad points.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xnew</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>



<div class="viewcode-block" id="near">
<a class="viewcode-back" href="../../RPSstuff.html#oceans.RPSstuff.near">[docs]</a>
<span class="k">def</span> <span class="nf">near</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given an 1D array `x` and a scalar `x0`, returns the `n` indices of the</span>
<span class="sd">    element of `x` closest to `x0`.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">index</span><span class="p">[:</span><span class="n">n</span><span class="p">],</span> <span class="n">distance</span><span class="p">[</span><span class="n">index</span><span class="p">[:</span><span class="n">n</span><span class="p">]]</span></div>



<div class="viewcode-block" id="swantime">
<a class="viewcode-back" href="../../RPSstuff.html#oceans.RPSstuff.swantime">[docs]</a>
<span class="k">def</span> <span class="nf">swantime</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts SWAN default time format to datetime object.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="n">year</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">a</span> <span class="o">/</span> <span class="mf">1e4</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="n">year</span> <span class="o">*</span> <span class="mf">1e4</span>
    <span class="n">mon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">a</span> <span class="o">/</span> <span class="mf">1e2</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="n">mon</span> <span class="o">*</span> <span class="mf">1e2</span>
    <span class="n">day</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="n">day</span>
    <span class="n">hour</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="mf">1e2</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="n">hour</span> <span class="o">/</span> <span class="mf">1e2</span>
    <span class="n">mn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="mf">1e4</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="n">mn</span> <span class="o">/</span> <span class="mf">1e4</span>
    <span class="n">sec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">mon</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span> <span class="n">mn</span><span class="p">,</span> <span class="n">sec</span><span class="p">)</span></div>



<div class="viewcode-block" id="shift">
<a class="viewcode-back" href="../../RPSstuff.html#oceans.RPSstuff.shift">[docs]</a>
<span class="k">def</span> <span class="nf">shift</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    a and b are vectors</span>
<span class="sd">    n is number of points of a to cut off</span>
<span class="sd">    anew and bnew will be the same length.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># la, lb = a.size, lb = b.size</span>

    <span class="n">anew</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">))),</span> <span class="p">:]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">anew</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
        <span class="n">anew</span> <span class="o">=</span> <span class="n">anew</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">))),</span> <span class="p">:]</span>
        <span class="n">bnew</span> <span class="o">=</span> <span class="n">b</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bnew</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">anew</span><span class="p">))),</span> <span class="p">:]</span>
    <span class="k">return</span> <span class="n">anew</span><span class="p">,</span> <span class="n">bnew</span></div>



<div class="viewcode-block" id="lagcor">
<a class="viewcode-back" href="../../RPSstuff.html#oceans.RPSstuff.lagcor">[docs]</a>
<span class="k">def</span> <span class="nf">lagcor</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finds lagged correlations between two series.</span>
<span class="sd">    a and b are two column vectors</span>
<span class="sd">    n is range of lags</span>
<span class="sd">    cor is correlation as fn of lag.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cor</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">shift</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">d1</span> <span class="o">+</span> <span class="n">d2</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">d1</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">d2</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">cor</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">cor</span></div>



<div class="viewcode-block" id="coast2bln">
<a class="viewcode-back" href="../../RPSstuff.html#oceans.RPSstuff.coast2bln">[docs]</a>
<span class="k">def</span> <span class="nf">coast2bln</span><span class="p">(</span><span class="n">coast</span><span class="p">,</span> <span class="n">bln_file</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a matlab coast (two column array w/ nan for line breaks) into</span>
<span class="sd">    a Surfer blanking file.</span>

<span class="sd">    Where coast is a two column vector and bln_file is the output file name.</span>

<span class="sd">    Needs `fixcoast`.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">c2</span> <span class="o">=</span> <span class="n">fixcoast</span><span class="p">(</span><span class="n">coast</span><span class="p">)</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">c2</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">bln</span> <span class="o">=</span> <span class="n">c2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">kk</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">ind</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ind</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
        <span class="n">NP</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">kk</span><span class="p">))</span>
        <span class="n">bln</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">NP</span>
        <span class="n">bln</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">bln</span> <span class="o">=</span> <span class="n">bln</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">bln_file</span><span class="p">,</span> <span class="n">bln</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%g</span><span class="s2">&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="fixcoast">
<a class="viewcode-back" href="../../RPSstuff.html#oceans.RPSstuff.fixcoast">[docs]</a>
<span class="k">def</span> <span class="nf">fixcoast</span><span class="p">(</span><span class="n">coast</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FIXCOAST  Makes sure coastlines meet Signell&#39;s conventions.</span>

<span class="sd">    Fixes coastline is in the format we want.  Assumes that lon/lat are in the</span>
<span class="sd">    first two columns of the matrix coast, and that coastline segments are</span>
<span class="sd">    separated by rows of NaNs (or -99999s).  This routine ensures that only 1</span>
<span class="sd">    row of NaNs separates each segment, and makes sure that the first and last</span>
<span class="sd">    rows contain NaNs.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ind</span> <span class="o">=</span> <span class="n">coast</span> <span class="o">==</span> <span class="o">-</span><span class="mf">99999.0</span>
    <span class="n">coast</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">coast</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
    <span class="n">idup</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dind</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">coast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">coast</span><span class="p">,</span> <span class="n">ind</span><span class="p">[</span><span class="n">idup</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">coast</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]):</span>
        <span class="n">coast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">coast</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">coast</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">coast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coast</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">coast</span></div>

</pre></div>

          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &#169;2023, Filipe Fernandes.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.0.2</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    
    <a href="https://github.com/pyoceans/oceans" class="github">
        <img src="../../_static/github-banner.svg" alt="Fork me on GitHub" class="github"/>
    </a>
    

    
  </body>
</html>